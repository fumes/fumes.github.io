<script>
  //progress_bar.js 
  $(document).ready(function(){
      
      var getMax = function(){
          return $(document).height() - $(window).height();
      }
      
      var getValue = function(){
          return $(window).scrollTop();
      }
      
      if('max' in document.createElement('progress')){
          // Browser supports progress element
          var progressBar = $('progress');
          
          // Set the Max attr for the first time
          progressBar.attr({ max: getMax() });

          $(document).on('scroll', function(){
              // On scroll only Value attr needs to be calculated
              progressBar.attr({ value: getValue() });
          });
        
          $(window).resize(function(){
              // On resize, both Max/Value attr needs to be calculated
              progressBar.attr({ max: getMax(), value: getValue() });
          });   
      }
      else {
          var progressBar = $('.progress-bar'), 
              max = getMax(), 
              value, width;
          
          var getWidth = function(){
              // Calculate width in percentage
              value = getValue();            
              width = (value/max) * 100;
              width = width + '%';
              return width;
          }
          
          var setWidth = function(){
              progressBar.css({ width: getWidth() });
          }
          
          $(document).on('scroll', setWidth);
          $(window).on('resize', function(){
              // Need to reset the Max attr
              max = getMax();
              setWidth();
          });
      }
  });




  $(document).ready(function(){
    
    $('#flat').addClass("active");
    $('#progressBar').addClass('flat');
      
    $('#flat').on('click', function(){
      $('#progressBar').removeClass().addClass('flat');
      $('a').removeClass();
      $(this).addClass('active');
      $(this).preventDefault();
    });

    $('#single').on('click', function(){
      $('#progressBar').removeClass().addClass('single');
      $('a').removeClass();    
      $(this).addClass('active');
      $(this).preventDefault();    
    });

    $('#multiple').on('click', function(){
      $('#progressBar').removeClass().addClass('multiple');
      $('a').removeClass();    
      $(this).addClass('active');
      $(this).preventDefault();    
    });

    $('#semantic').on('click', function(){
      $('#progressBar').removeClass().addClass('semantic');
      $('a').removeClass();    
      $(this).addClass('active');
      $(this).preventDefault();
      alert('hello');
    });

    $(document).on('scroll', function(){

        maxAttr = $('#progressBar').attr('max');
        valueAttr = $('#progressBar').attr('value');
        percentage = (valueAttr/maxAttr) * 100;
        
        if(percentage<49){
          document.styleSheets[0].addRule('.semantic', 'color: red');
          document.styleSheets[0].addRule('.semantic::-webkit-progress-value', 'background-color: red');
          document.styleSheets[0].addRule('.semantic::-moz-progress-bar', 'background-color: red');
        }
        else if(percentage<98){
          document.styleSheets[0].addRule('.semantic', 'color: orange');
          document.styleSheets[0].addRule('.semantic::-webkit-progress-value', 'background-color: orange');
          document.styleSheets[0].addRule('.semantic::-moz-progress-bar', 'background-color: orange');
        }
        else {
          document.styleSheets[0].addRule('.semantic', 'color: green');
          document.styleSheets[0].addRule('.semantic::-webkit-progress-value', 'background-color: green');
          document.styleSheets[0].addRule('.semantic::-moz-progress-bar', 'background-color: green');
        }      
    });
    
  });


</script>

<script>
  //APPEND to copy action
  //https://www.jitbit.com/alexblog/230-javascript-injecting-extra-info-to-copy-pasted-text/
  function addLink() {

    if (typeof window.getSelection == "undefined") return; //IE8 or earlier...
    
    var body_element = document.getElementsByTagName('body')[0];
    var selection = window.getSelection();
    
    //if the selection is short let's not annoy our users
    if (("" + selection).length < 30) return;

    //create a div outside of the visible area
    //and fill it with the selected text
    var newdiv = document.createElement('div');
    newdiv.style.position = 'absolute';
    newdiv.style.left = '-99999px';
    body_element.appendChild(newdiv);
    newdiv.appendChild(selection.getRangeAt(0).cloneContents());
    
    //we need a <pre> tag workaround
    //otherwise the text inside "pre" loses all the line breaks!
    if (selection.getRangeAt(0).commonAncestorContainer.nodeName == "PRE") {
      newdiv.innerHTML = "<pre>" + newdiv.innerHTML + "</pre>";
    }
    
    newdiv.innerHTML += "<br /><br />&#9786; YO! this is an extract from Fumes: <a href='"
    + document.location.href + "'>"
    + document.location.href + "</a><br />&#9775; 2015 &copy; Fumes project. Licensed under a Creative Commons Attribution 4.0 International License.<br />&#9775; Photos articles have own license policy, please check.";
        
    selection.selectAllChildren(newdiv);
    window.setTimeout(function () { body_element.removeChild(newdiv); }, 200);
  }
  document.oncopy = addLink;

</script>

{% if site.owner.google.analytics %}
  <script>
  //Asynchronous Google Analytics snippet
    var _gaq = _gaq || [];
    var pluginUrl = 
   '//www.google-analytics.com/plugins/ga/inpage_linkid.js';
    _gaq.push(['_require', 'inpage_linkid', pluginUrl]);
    _gaq.push(['_setAccount', '{{ site.owner.google.analytics }}']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
{% endif %}
